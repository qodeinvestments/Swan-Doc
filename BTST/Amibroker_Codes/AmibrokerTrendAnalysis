
#include <F&O includeok.afl>
#include <F&O BanList.afl>
#include <F&O expiry selection.afl>

TimeFrameSet(inDaily);
NextDay = valuewhen(Day() != Ref(Day(),1),Ref(DateNum(),1));
NextDay = DateTimeConvert(2,NextDay);
CurrentDate = DateTimeConvert(2,DateNum());
Difference = round(DateTimeDiff(NextDay,CurrentDate)/(3600*24));
TimeFrameRestore();

Difference = TimeFrameExpand(Difference,inDaily,expandFirst);

open1 = ValueWhen(Day() != Ref(Day(),-1),open,1);

gap = IIf(ValueWhen(TimeNum() == 113000,DateNum(),1) == DateNum(),(ValueWhen(TimeNum() == 113000,Close,1)/Open1-1),Null);

chg091500 = IIf(Valuewhen(timenum()==091500,datenum(),1) == DateNum(),(Valuewhen(timenum()==091500,Close,1)/Open1-1),Null) ;
chg092000 = IIf(Valuewhen(timenum()==092000,datenum(),1) == DateNum(),(Valuewhen(timenum()==092000,Close,1)/Open1-1),Null) ;
chg092500 = IIf(Valuewhen(timenum()==092500,datenum(),1) == DateNum(),(Valuewhen(timenum()==092500,Close,1)/Open1-1),Null) ;
chg093000 = IIf(Valuewhen(timenum()==093000,datenum(),1) == DateNum(),(Valuewhen(timenum()==093000,Close,1)/Open1-1),Null) ;
chg093500 = IIf(Valuewhen(timenum()==093500,datenum(),1) == DateNum(),(Valuewhen(timenum()==093500,Close,1)/Open1-1),Null) ;
chg094000 = IIf(Valuewhen(timenum()==094000,datenum(),1) == DateNum(),(Valuewhen(timenum()==094000,Close,1)/Open1-1),Null) ;
chg094500 = IIf(Valuewhen(timenum()==094500,datenum(),1) == DateNum(),(Valuewhen(timenum()==094500,Close,1)/Open1-1),Null) ;
chg095000 = IIf(Valuewhen(timenum()==095000,datenum(),1) == DateNum(),(Valuewhen(timenum()==095000,Close,1)/Open1-1),Null) ;
chg095500 = IIf(Valuewhen(timenum()==095500,datenum(),1) == DateNum(),(Valuewhen(timenum()==095500,Close,1)/Open1-1),Null) ;
chg100000 = IIf(Valuewhen(timenum()==100000,datenum(),1) == DateNum(),(Valuewhen(timenum()==100000,Close,1)/Open1-1),Null) ;
chg100500 = IIf(Valuewhen(timenum()==100500,datenum(),1) == DateNum(),(Valuewhen(timenum()==100500,Close,1)/Open1-1),Null) ;
chg101000 = IIf(Valuewhen(timenum()==101000,datenum(),1) == DateNum(),(Valuewhen(timenum()==101000,Close,1)/Open1-1),Null) ;
chg101500 = IIf(Valuewhen(timenum()==101500,datenum(),1) == DateNum(),(Valuewhen(timenum()==101500,Close,1)/Open1-1),Null) ;
chg102000 = IIf(Valuewhen(timenum()==102000,datenum(),1) == DateNum(),(Valuewhen(timenum()==102000,Close,1)/Open1-1),Null) ;
chg102500 = IIf(Valuewhen(timenum()==102500,datenum(),1) == DateNum(),(Valuewhen(timenum()==102500,Close,1)/Open1-1),Null) ;
chg103000 = IIf(Valuewhen(timenum()==103000,datenum(),1) == DateNum(),(Valuewhen(timenum()==103000,Close,1)/Open1-1),Null) ;
chg103500 = IIf(Valuewhen(timenum()==103500,datenum(),1) == DateNum(),(Valuewhen(timenum()==103500,Close,1)/Open1-1),Null) ;
chg104000 = IIf(Valuewhen(timenum()==104000,datenum(),1) == DateNum(),(Valuewhen(timenum()==104000,Close,1)/Open1-1),Null) ;
chg104500 = IIf(Valuewhen(timenum()==104500,datenum(),1) == DateNum(),(Valuewhen(timenum()==104500,Close,1)/Open1-1),Null) ;
chg105000 = IIf(Valuewhen(timenum()==105000,datenum(),1) == DateNum(),(Valuewhen(timenum()==105000,Close,1)/Open1-1),Null) ;
chg105500 = IIf(Valuewhen(timenum()==105500,datenum(),1) == DateNum(),(Valuewhen(timenum()==105500,Close,1)/Open1-1),Null) ;
chg110000 = IIf(Valuewhen(timenum()==110000,datenum(),1) == DateNum(),(Valuewhen(timenum()==110000,Close,1)/Open1-1),Null) ;
chg110500 = IIf(Valuewhen(timenum()==110500,datenum(),1) == DateNum(),(Valuewhen(timenum()==110500,Close,1)/Open1-1),Null) ;
chg111000 = IIf(Valuewhen(timenum()==111000,datenum(),1) == DateNum(),(Valuewhen(timenum()==111000,Close,1)/Open1-1),Null) ;
chg111500 = IIf(Valuewhen(timenum()==111500,datenum(),1) == DateNum(),(Valuewhen(timenum()==111500,Close,1)/Open1-1),Null) ;
chg112000 = IIf(Valuewhen(timenum()==112000,datenum(),1) == DateNum(),(Valuewhen(timenum()==112000,Close,1)/Open1-1),Null) ;
chg112500 = IIf(Valuewhen(timenum()==112500,datenum(),1) == DateNum(),(Valuewhen(timenum()==112500,Close,1)/Open1-1),Null) ;
chg113000 = IIf(Valuewhen(timenum()==113000,datenum(),1) == DateNum(),(Valuewhen(timenum()==113000,Close,1)/Open1-1),Null) ;
chg113500 = IIf(Valuewhen(timenum()==113500,datenum(),1) == DateNum(),(Valuewhen(timenum()==113500,Close,1)/Open1-1),Null) ;
chg114000 = IIf(Valuewhen(timenum()==114000,datenum(),1) == DateNum(),(Valuewhen(timenum()==114000,Close,1)/Open1-1),Null) ;
chg114500 = IIf(Valuewhen(timenum()==114500,datenum(),1) == DateNum(),(Valuewhen(timenum()==114500,Close,1)/Open1-1),Null) ;
chg115000 = IIf(Valuewhen(timenum()==115000,datenum(),1) == DateNum(),(Valuewhen(timenum()==115000,Close,1)/Open1-1),Null) ;
chg115500 = IIf(Valuewhen(timenum()==115500,datenum(),1) == DateNum(),(Valuewhen(timenum()==115500,Close,1)/Open1-1),Null) ;
chg120000 = IIf(Valuewhen(timenum()==120000,datenum(),1) == DateNum(),(Valuewhen(timenum()==120000,Close,1)/Open1-1),Null) ;
chg120500 = IIf(Valuewhen(timenum()==120500,datenum(),1) == DateNum(),(Valuewhen(timenum()==120500,Close,1)/Open1-1),Null) ;
chg121000 = IIf(Valuewhen(timenum()==121000,datenum(),1) == DateNum(),(Valuewhen(timenum()==121000,Close,1)/Open1-1),Null) ;
chg121500 = IIf(Valuewhen(timenum()==121500,datenum(),1) == DateNum(),(Valuewhen(timenum()==121500,Close,1)/Open1-1),Null) ;
chg122000 = IIf(Valuewhen(timenum()==122000,datenum(),1) == DateNum(),(Valuewhen(timenum()==122000,Close,1)/Open1-1),Null) ;
chg122500 = IIf(Valuewhen(timenum()==122500,datenum(),1) == DateNum(),(Valuewhen(timenum()==122500,Close,1)/Open1-1),Null) ;
chg123000 = IIf(Valuewhen(timenum()==123000,datenum(),1) == DateNum(),(Valuewhen(timenum()==123000,Close,1)/Open1-1),Null) ;
chg123500 = IIf(Valuewhen(timenum()==123500,datenum(),1) == DateNum(),(Valuewhen(timenum()==123500,Close,1)/Open1-1),Null) ;
chg124000 = IIf(Valuewhen(timenum()==124000,datenum(),1) == DateNum(),(Valuewhen(timenum()==124000,Close,1)/Open1-1),Null) ;
chg124500 = IIf(Valuewhen(timenum()==124500,datenum(),1) == DateNum(),(Valuewhen(timenum()==124500,Close,1)/Open1-1),Null) ;
chg125000 = IIf(Valuewhen(timenum()==125000,datenum(),1) == DateNum(),(Valuewhen(timenum()==125000,Close,1)/Open1-1),Null) ;
chg125500 = IIf(Valuewhen(timenum()==125500,datenum(),1) == DateNum(),(Valuewhen(timenum()==125500,Close,1)/Open1-1),Null) ;
chg130000 = IIf(Valuewhen(timenum()==130000,datenum(),1) == DateNum(),(Valuewhen(timenum()==130000,Close,1)/Open1-1),Null) ;
chg130500 = IIf(Valuewhen(timenum()==130500,datenum(),1) == DateNum(),(Valuewhen(timenum()==130500,Close,1)/Open1-1),Null) ;
chg131000 = IIf(Valuewhen(timenum()==131000,datenum(),1) == DateNum(),(Valuewhen(timenum()==131000,Close,1)/Open1-1),Null) ;
chg131500 = IIf(Valuewhen(timenum()==131500,datenum(),1) == DateNum(),(Valuewhen(timenum()==131500,Close,1)/Open1-1),Null) ;
chg132000 = IIf(Valuewhen(timenum()==132000,datenum(),1) == DateNum(),(Valuewhen(timenum()==132000,Close,1)/Open1-1),Null) ;
chg132500 = IIf(Valuewhen(timenum()==132500,datenum(),1) == DateNum(),(Valuewhen(timenum()==132500,Close,1)/Open1-1),Null) ;
chg133000 = IIf(Valuewhen(timenum()==133000,datenum(),1) == DateNum(),(Valuewhen(timenum()==133000,Close,1)/Open1-1),Null) ;
chg133500 = IIf(Valuewhen(timenum()==133500,datenum(),1) == DateNum(),(Valuewhen(timenum()==133500,Close,1)/Open1-1),Null) ;
chg134000 = IIf(Valuewhen(timenum()==134000,datenum(),1) == DateNum(),(Valuewhen(timenum()==134000,Close,1)/Open1-1),Null) ;
chg134500 = IIf(Valuewhen(timenum()==134500,datenum(),1) == DateNum(),(Valuewhen(timenum()==134500,Close,1)/Open1-1),Null) ;
chg135000 = IIf(Valuewhen(timenum()==135000,datenum(),1) == DateNum(),(Valuewhen(timenum()==135000,Close,1)/Open1-1),Null) ;
chg135500 = IIf(Valuewhen(timenum()==135500,datenum(),1) == DateNum(),(Valuewhen(timenum()==135500,Close,1)/Open1-1),Null) ;
chg140000 = IIf(Valuewhen(timenum()==140000,datenum(),1) == DateNum(),(Valuewhen(timenum()==140000,Close,1)/Open1-1),Null) ;
chg140500 = IIf(Valuewhen(timenum()==140500,datenum(),1) == DateNum(),(Valuewhen(timenum()==140500,Close,1)/Open1-1),Null) ;
chg141000 = IIf(Valuewhen(timenum()==141000,datenum(),1) == DateNum(),(Valuewhen(timenum()==141000,Close,1)/Open1-1),Null) ;
chg141500 = IIf(Valuewhen(timenum()==141500,datenum(),1) == DateNum(),(Valuewhen(timenum()==141500,Close,1)/Open1-1),Null) ;
chg142000 = IIf(Valuewhen(timenum()==142000,datenum(),1) == DateNum(),(Valuewhen(timenum()==142000,Close,1)/Open1-1),Null) ;
chg142500 = IIf(Valuewhen(timenum()==142500,datenum(),1) == DateNum(),(Valuewhen(timenum()==142500,Close,1)/Open1-1),Null) ;
chg143000 = IIf(Valuewhen(timenum()==143000,datenum(),1) == DateNum(),(Valuewhen(timenum()==143000,Close,1)/Open1-1),Null) ;
chg143500 = IIf(Valuewhen(timenum()==143500,datenum(),1) == DateNum(),(Valuewhen(timenum()==143500,Close,1)/Open1-1),Null) ;
chg144000 = IIf(Valuewhen(timenum()==144000,datenum(),1) == DateNum(),(Valuewhen(timenum()==144000,Close,1)/Open1-1),Null) ;
chg144500 = IIf(Valuewhen(timenum()==144500,datenum(),1) == DateNum(),(Valuewhen(timenum()==144500,Close,1)/Open1-1),Null) ;
chg145000 = IIf(Valuewhen(timenum()==145000,datenum(),1) == DateNum(),(Valuewhen(timenum()==145000,Close,1)/Open1-1),Null) ;
chg145500 = IIf(Valuewhen(timenum()==145500,datenum(),1) == DateNum(),(Valuewhen(timenum()==145500,Close,1)/Open1-1),Null) ;
chg150000 = IIf(Valuewhen(timenum()==150000,datenum(),1) == DateNum(),(Valuewhen(timenum()==150000,Close,1)/Open1-1),Null) ;
chg150500 = IIf(Valuewhen(timenum()==150500,datenum(),1) == DateNum(),(Valuewhen(timenum()==150500,Close,1)/Open1-1),Null) ;
chg151000 = IIf(Valuewhen(timenum()==151000,datenum(),1) == DateNum(),(Valuewhen(timenum()==151000,Close,1)/Open1-1),Null) ;
chg151500 = IIf(Valuewhen(timenum()==151500,datenum(),1) == DateNum(),(Valuewhen(timenum()==151500,Close,1)/Open1-1),Null) ;
chg152000 = IIf(Valuewhen(timenum()==152000,datenum(),1) == DateNum(),(Valuewhen(timenum()==152000,Close,1)/Open1-1),Null) ;
chg152500 = IIf(Valuewhen(timenum()==152500,datenum(),1) == DateNum(),(Valuewhen(timenum()==152500,Close,1)/Open1-1),Null) ;
chg153000 = IIf(Valuewhen(timenum()==153000,datenum(),1) == DateNum(),(Valuewhen(timenum()==153000,Close,1)/Open1-1),Null) ;

TimeFrameSet(inDaily);
Nextday = Ref(DateNum(),1);
TimeFrameRestore();
nextday = TimeFrameExpand(nextday,inDaily,expandFirst);

chg091500nxt = IIf(Valuewhen(timenum()==091500,datenum(),0) == nextday,(Valuewhen(timenum()==091500,Close,0)/Open1-1),Null) ;
chg092000nxt = IIf(Valuewhen(timenum()==092000,datenum(),0) == nextday,(Valuewhen(timenum()==092000,Close,0)/Open1-1),Null) ;
chg092500nxt = IIf(Valuewhen(timenum()==092500,datenum(),0) == nextday,(Valuewhen(timenum()==092500,Close,0)/Open1-1),Null) ;
chg093000nxt = IIf(Valuewhen(timenum()==093000,datenum(),0) == nextday,(Valuewhen(timenum()==093000,Close,0)/Open1-1),Null) ;
chg093500nxt = IIf(Valuewhen(timenum()==093500,datenum(),0) == nextday,(Valuewhen(timenum()==093500,Close,0)/Open1-1),Null) ;
chg094000nxt = IIf(Valuewhen(timenum()==094000,datenum(),0) == nextday,(Valuewhen(timenum()==094000,Close,0)/Open1-1),Null) ;
chg094500nxt = IIf(Valuewhen(timenum()==094500,datenum(),0) == nextday,(Valuewhen(timenum()==094500,Close,0)/Open1-1),Null) ;
chg095000nxt = IIf(Valuewhen(timenum()==095000,datenum(),0) == nextday,(Valuewhen(timenum()==095000,Close,0)/Open1-1),Null) ;
chg095500nxt = IIf(Valuewhen(timenum()==095500,datenum(),0) == nextday,(Valuewhen(timenum()==095500,Close,0)/Open1-1),Null) ;
chg100000nxt = IIf(Valuewhen(timenum()==100000,datenum(),0) == nextday,(Valuewhen(timenum()==100000,Close,0)/Open1-1),Null) ;



Filter = overnight AND excludeok == 0 AND Difference<=10 AND ((Day() != Ref(Day(),1) OR BarIndex() == BarCount-1)); //includeok AND excludeok == 0 AND ((Day() != Ref(Day(),1) OR BarIndex() == BarCount-1)); (This is incase the Analysis is done on Equities).
AddColumn(gap,"Gap");
AddColumn(open1,"open1");
addcolumn(chg091500,"091500chg",1.6);
addcolumn(chg092000,"092000chg",1.6);
addcolumn(chg092500,"092500chg",1.6);
addcolumn(chg093000,"093000chg",1.6);
addcolumn(chg093500,"093500chg",1.6);
addcolumn(chg094000,"094000chg",1.6);
addcolumn(chg094500,"094500chg",1.6);
addcolumn(chg095000,"095000chg",1.6);
addcolumn(chg095500,"095500chg",1.6);
addcolumn(chg100000,"100000chg",1.6);
addcolumn(chg100500,"100500chg",1.6);
addcolumn(chg101000,"101000chg",1.6);
addcolumn(chg101500,"101500chg",1.6);
addcolumn(chg102000,"102000chg",1.6);
addcolumn(chg102500,"102500chg",1.6);
addcolumn(chg103000,"103000chg",1.6);
addcolumn(chg103500,"103500chg",1.6);
addcolumn(chg104000,"104000chg",1.6);
addcolumn(chg104500,"104500chg",1.6);
addcolumn(chg105000,"105000chg",1.6);
addcolumn(chg105500,"105500chg",1.6);
addcolumn(chg110000,"110000chg",1.6);
addcolumn(chg110500,"110500chg",1.6);
addcolumn(chg111000,"111000chg",1.6);
addcolumn(chg111500,"111500chg",1.6);
addcolumn(chg112000,"112000chg",1.6);
addcolumn(chg112500,"112500chg",1.6);
addcolumn(chg113000,"113000chg",1.6);
addcolumn(chg113500,"113500chg",1.6);
addcolumn(chg114000,"114000chg",1.6);
addcolumn(chg114500,"114500chg",1.6);
addcolumn(chg115000,"115000chg",1.6);
addcolumn(chg115500,"115500chg",1.6);
addcolumn(chg120000,"120000chg",1.6);
addcolumn(chg120500,"120500chg",1.6);
addcolumn(chg121000,"121000chg",1.6);
addcolumn(chg121500,"121500chg",1.6);
addcolumn(chg122000,"122000chg",1.6);
addcolumn(chg122500,"122500chg",1.6);
addcolumn(chg123000,"123000chg",1.6);
addcolumn(chg123500,"123500chg",1.6);
addcolumn(chg124000,"124000chg",1.6);
addcolumn(chg124500,"124500chg",1.6);
addcolumn(chg125000,"125000chg",1.6);
addcolumn(chg125500,"125500chg",1.6);
addcolumn(chg130000,"130000chg",1.6);
addcolumn(chg130500,"130500chg",1.6);
addcolumn(chg131000,"131000chg",1.6);
addcolumn(chg131500,"131500chg",1.6);
addcolumn(chg132000,"132000chg",1.6);
addcolumn(chg132500,"132500chg",1.6);
addcolumn(chg133000,"133000chg",1.6);
addcolumn(chg133500,"133500chg",1.6);
addcolumn(chg134000,"134000chg",1.6);
addcolumn(chg134500,"134500chg",1.6);
addcolumn(chg135000,"135000chg",1.6);
addcolumn(chg135500,"135500chg",1.6);
addcolumn(chg140000,"140000chg",1.6);
addcolumn(chg140500,"140500chg",1.6);
addcolumn(chg141000,"141000chg",1.6);
addcolumn(chg141500,"141500chg",1.6);
addcolumn(chg142000,"142000chg",1.6);
addcolumn(chg142500,"142500chg",1.6);
addcolumn(chg143000,"143000chg",1.6);
addcolumn(chg143500,"143500chg",1.6);
addcolumn(chg144000,"144000chg",1.6);
addcolumn(chg144500,"144500chg",1.6);
addcolumn(chg145000,"145000chg",1.6);
addcolumn(chg145500,"145500chg",1.6);
addcolumn(chg150000,"150000chg",1.6);
addcolumn(chg150500,"150500chg",1.6);
addcolumn(chg151000,"151000chg",1.6);
addcolumn(chg151500,"151500chg",1.6);
addcolumn(chg152000,"152000chg",1.6);
addcolumn(chg152500,"152500chg",1.6);
AddColumn(chg091500nxt,"091500chgnxt",1.6);
AddColumn(chg092000nxt,"092000chgnxt",1.6);
AddColumn(chg092500nxt,"092500chgnxt",1.6);
AddColumn(chg093000nxt,"093000chgnxt",1.6);
AddColumn(chg093500nxt,"093500chgnxt",1.6);
AddColumn(chg094000nxt,"094000chgnxt",1.6);
AddColumn(chg094500nxt,"094500chgnxt",1.6);
AddColumn(chg095000nxt,"095000chgnxt",1.6);
AddColumn(chg095500nxt,"095500chgnxt",1.6);
AddColumn(chg100000nxt,"100000chgnxt",1.6);
